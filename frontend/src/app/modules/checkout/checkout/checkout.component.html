<div class="checkout-container" *ngIf="!loading; else loadingTemplate">
  <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
    <h2>Shipping Information</h2>
    <div>
      <label>Full Name *</label>
      <input formControlName="fullName" type="text" />
    </div>
    <div>
      <label>Address Line 1 *</label>
      <input formControlName="addressLine1" type="text" />
    </div>
    <div>
      <label>Address Line 2</label>
      <input formControlName="addressLine2" type="text" />
    </div>
    <div>
      <label>City *</label>
      <input formControlName="city" type="text" />
    </div>
    <div>
      <label>State *</label>
      <input formControlName="state" type="text" />
    </div>
    <div>
      <label>Postal Code *</label>
      <input formControlName="postalCode" type="text" />
    </div>
    <div>
      <label>Country *</label>
      <input formControlName="country" type="text" />
    </div>
    <div>
      <label>Phone Number *</label>
      <input formControlName="phoneNumber" type="text" />
    </div>
    <div>
      <label>Email *</label>
      <input formControlName="email" type="email" />
    </div>

    <h2>Payment Method</h2>

<!-- ⭐ payment adındaki formGroup'a giriyoruz -->
<div formGroupName="payment">

  <label>
    <input type="radio" formControlName="method" value="COD" />
    Pay on Delivery
  </label>

  <label>
    <input type="radio" formControlName="method" value="STRIPE" />
    Credit Card
  </label>

  <label>
    <input type="radio" formControlName="method" value="PAYPAL" />
    PayPal
  </label>
</div>

<!-- Stripe Payment (Credit Card) -->
<div *ngIf="paymentMethod === 'STRIPE'">
  <div #cardEl id="card-element"></div>
  <div id="card-errors" class="error-message"></div>
</div>


<!-- PayPal Payment -->
<div *ngIf="paymentMethod === 'PAYPAL'" class="paypal-container">
  <h4>Pay with PayPal</h4>
  <!-- ⭐ ViewChild ismi de eşleşsin -->
  <div #paypalEl id="paypal-button-container"></div>
</div>

    <h2>Order Summary</h2>
    <div *ngFor="let entry of cartItems">
      <p>
        {{ entry.product.title }}
        (x{{ entry.item.quantity }}) -
        ${{ (entry.product.price * entry.item.quantity) | number:'1.2-2' }}
      </p>
    </div>
    <p>Subtotal: ${{ subtotal    | number:'1.2-2' }}</p>
    <p>Shipping: ${{ shippingFee | number:'1.2-2' }}</p>
    <p *ngIf="discount > 0">Discount: -${{ discount | number:'1.2-2' }}</p>
    <h3>Total: {{ total            | number:'1.2-2' }}</h3>
    <button
      type="submit"
      [disabled]="checkoutForm.invalid || submitting">
      Place Order
    </button>
  </form>
</div>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <p>Loading your cart...</p>
</ng-template>
