<!-- Product Detail Component Template -->
<div class="product-detail-container" *ngIf="!loading && !error && product">
  <!-- Left side: Product Images -->
  <div class="product-images-container">
    <!-- Main image display -->
    <div class="main-image-container">
      <img
        [src]="product.mainImageUrl"
        [alt]="product.name"
        class="main-image"
        (error)="handleImageError($event)"
        loading="lazy">
    </div>

    <!-- Thumbnail gallery -->
    <div class="image-gallery" *ngIf="productImages.length > 0">
      <button
        class="thumbnail-container"
        *ngFor="let image of productImages"
        [class.active]="image.imageUrl === product.mainImageUrl"
        (click)="product.mainImageUrl = image.imageUrl">
        <img
          [src]="image.imageUrl"
          [alt]="product.name + ' thumbnail'"
          class="thumbnail-image"
          (error)="handleImageError($event)"
          loading="lazy">
      </button>
    </div>
  </div>

  <!-- Right side: Product Info -->
  <div class="product-info-container">
    <!-- Product name and category -->
    <div class="product-header">
      <h1 class="product-name">{{ product.name }}</h1>
      <span class="product-category">{{ product.category?.name }}</span>
    </div>

    <!-- Rating -->
    <div class="rating-container" *ngIf="product.ratingAverage">
      <span class="stars" role="img" [attr.aria-label]="'Product rating: ' + product.ratingAverage + ' out of 5 stars'">
        <span class="star" *ngFor="let star of [1,2,3,4,5]">
          <span class="star-fill" [style.width.%]="getStarFillPercentage(star, product.ratingAverage)"></span>
        </span>
      </span>
      <span class="rating-value">{{ product.ratingAverage | number:'1.1-1' }}</span>
    </div>

    <!-- Description -->
    <p class="product-description" *ngIf="product.description">{{ product.description }}</p>

    <!-- Price information -->
    <div class="price-container">
      <div class="price-wrapper">
        <ng-container *ngIf="product.discountPercentage; else regularPrice">
          <div class="price-discount-container">
            <span class="original-price">{{ product.price | currency }}</span>
            <span class="discounted-price">{{ getDiscountedPrice(product.price, product.discountPercentage) | currency }}</span>
          </div>
          <span class="discount-badge">{{ product.discountPercentage }}% OFF</span>
        </ng-container>
        <ng-template #regularPrice>
          <span class="current-price">{{ product.price | currency }}</span>
        </ng-template>
      </div>
    </div>

    <!-- Stock status -->
    <div class="stock-container">
      <ng-container *ngIf="product.stock > 0; else outOfStock">
        <span class="in-stock" [class.low-stock]="product.stock < 10">
          {{ product.stock < 10 ? 'Low Stock: ' + product.stock + ' left' : 'In Stock' }}
        </span>
      </ng-container>
      <ng-template #outOfStock>
        <span class="out-of-stock">Out of Stock</span>
      </ng-template>
    </div>

    <!-- Add to cart button -->
    <button
      class="bolt-btn primary-btn add-to-cart-btn"
      [disabled]="product.stock <= 0 || !product.isActive"
      (click)="onAdd()">
      Add to Cart
    </button>
  </div>
</div>

<!-- Loading state -->
<div class="loading-container" *ngIf="loading">
  <p>Loading product details...</p>
</div>

<!-- Error state -->
<div class="error-container" *ngIf="error">
  <p>{{ error }}</p>
  <button class="bolt-btn" (click)="retry()">Retry</button>
  <button class="bolt-btn secondary" (click)="goBack()">Go Back</button>
</div>

<!-- Tabbed section -->
<div class="product-tabs-container" *ngIf="!loading && !error && product">
  <div class="tabs">
    <input type="radio" id="tab1" name="product-tabs" checked>
    <label for="tab1" class="tab-label">Product Details</label>
    <div class="tab-content">
      <div class="product-details" *ngIf="product.productDetails">
        {{ product.productDetails }}
      </div>
      <div class="no-details" *ngIf="!product.productDetails">
        No detailed information available for this product.
      </div>
    </div>

    <input type="radio" id="tab2" name="product-tabs">
    <label for="tab2" class="tab-label">Reviews</label>
    <div class="tab-content">
      <app-review-list [productId]="product.id"></app-review-list>
    </div>
  </div>
</div>
