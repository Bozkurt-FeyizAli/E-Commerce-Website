<div class="min-h-screen bg-gray-50">
  <!-- Search Header -->
  <div class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex items-center space-x-4">
        <div class="flex-1 relative">
          <input
            type="text"
            placeholder="Search products..."
            class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200"
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
          />
        </div>
        <button
          class="p-2 text-gray-600 hover:text-gray-900 sm:hidden"
          (click)="toggleFilters()"
          aria-label="Toggle filters"
        >
          <mat-icon>filter_list</mat-icon>
        </button>
        <div class="hidden sm:flex items-center space-x-4">
          <button
            class="p-2"
            [class.text-indigo-600]="viewMode === 'grid'"
            [class.text-gray-400]="viewMode === 'list'"
            (click)="viewMode = 'grid'"
            aria-label="Grid view"
          >
            <mat-icon>grid_view</mat-icon>
          </button>
          <button
            class="p-2"
            [class.text-indigo-600]="viewMode === 'list'"
            [class.text-gray-400]="viewMode === 'grid'"
            (click)="viewMode = 'list'"
            aria-label="List view"
          >
            <mat-icon>list</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-col sm:flex-row gap-8">
      <!-- Filters Sidebar -->
      <div class="w-full sm:w-64 flex-shrink-0" [class.hidden]="!showFilters" [class.sm:block]="true">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-lg font-semibold mb-4">Filters</h2>

          <!-- Categories -->
          <div class="mb-6">
            <h3 class="font-medium mb-2">Categories</h3>
            <div class="space-y-2">
              <label *ngFor="let category of categories" class="flex items-center">
                <input
                  type="checkbox"
                  [checked]="filters.category.includes(category)"
                  (change)="toggleFilter('category', category)"
                  class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                />
                <span class="ml-2 text-sm">{{ category }}</span>
              </label>
            </div>
          </div>

          <!-- Brands -->
          <div class="mb-6">
            <h3 class="font-medium mb-2">Brands</h3>
            <div class="space-y-2">
              <label *ngFor="let brand of brands" class="flex items-center">
                <input
                  type="checkbox"
                  [checked]="filters.brand.includes(brand)"
                  (change)="toggleFilter('brand', brand)"
                  class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                />
                <span class="ml-2 text-sm">{{ brand }}</span>
              </label>
            </div>
          </div>

          <!-- Price Range -->
          <div class="mb-6">
            <h3 class="font-medium mb-2">Price Range</h3>
            <div class="space-y-2">
              <input
                type="range"
                [min]="0"
                [max]="1000"
                [(ngModel)]="filters.priceRange[1]"
                (input)="applyFilters()"
                class="w-full"
              />
              <div class="flex justify-between text-sm text-gray-600">
                <span>$0</span>
                <span>${{ filters.priceRange[1] }}</span>
              </div>
            </div>
          </div>

          <!-- Stock Status -->
          <div>
            <label class="flex items-center">
              <input
                type="checkbox"
                [(ngModel)]="filters.inStock"
                (change)="applyFilters()"
                class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
              />
              <span class="ml-2 text-sm">In Stock Only</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Product Grid -->
      <div class="flex-1">
        <!-- Loading -->
        <div *ngIf="loading" class="text-center py-10">
          <mat-spinner diameter="50"></mat-spinner>
          <p class="mt-2 text-gray-500">Loading products...</p>
        </div>

        <!-- Error -->
        <div *ngIf="error" class="text-center py-10 text-red-600">
          <p>{{ error }}</p>
          <button mat-raised-button color="primary" (click)="retryLoading()">Retry</button>
        </div>

        <!-- Products -->
        <div *ngIf="!loading && !error">
          <div [class]="viewMode === 'grid' ? 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6' : 'space-y-4'">
            <div *ngFor="let product of filteredProducts" class="bg-white rounded-lg shadow overflow-hidden">
              <div>
                <img
                  [src]="product.mainImageUrl"
                  [alt]="product.name"
                  class="w-full h-48 object-cover"
                  (error)="handleImageError($event)"
                />
              </div>
              <div class="p-4">
                <div class="text-sm text-indigo-600 mb-1">
                  <ng-container *ngIf="product.category; else noCategory">
                    {{ product.category.name }}
                  </ng-container>
                  <ng-template #noCategory>
                    Uncategorized
                  </ng-template>
                </div>

                <h3 class="text-lg font-semibold text-gray-900 mb-2">
                  {{ product.name }}
                </h3>
                <p class="text-sm text-gray-500 mb-4" *ngIf="viewMode === 'list'">
                  {{ product.description }}
                </p>
                <div class="flex items-center justify-between">
                  <span class="text-lg font-bold text-gray-900">
                    {{ product.price | currency:'TRY':'symbol':'1.2-2' }}
                  </span>
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="addToCart(product)"
                    [disabled]="product.stock <= 0"
                  >
                    Add to Cart
                  </button>
                </div>
              </div>
            </div>

            <!-- No Products -->
            <div *ngIf="filteredProducts.length === 0" class="text-center w-full py-10 text-gray-500">
              <p>No products match your filters.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
